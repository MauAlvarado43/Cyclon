{"version":3,"file":"unregister.js","names":["router","Router","get","req","res","session","error","language","acceptsLanguages","user","redirect","assets","JSON","parse","fs","readFileSync","path","join","__dirname","render","title","titles","index","errors","privacy","terms","send","passport","authenticate","authType","scope","next","err","info","logIn","type","post","User","find","email","encryptAES","decryptAndroid","body","docs","errorLog","length","newUser","geo","lat","lng","userObject","encryptUser","id","name","lastName","last_name","location","password","register","verify","save","json","encryptFromFront","sendEmail","decryptAES","cookie","stringify","destroy","logout","clearCookie","context","toString","functions","download","module","exports"],"sources":["../../src/routes/unregister.js"],"sourcesContent":["import {Router} from 'express'\r\nimport passport from 'passport'\r\nimport {UserModel as User} from '../models/UserModel'\r\nimport geoip from 'geoip-lite'\r\nimport path from 'path'\r\nimport fs from 'fs'\r\nimport { encryptFront, decryptFront, encryptAES, decryptAES, encryptAndroid, decryptAndroid, encryptFromFront} from '../utils/cipher'\r\nimport { errorLog } from '../utils/logger'\r\nimport { sendEmail } from '../utils/email'\r\n\r\nconst router = Router()\r\n\r\n/***************************************\r\n                Rendering\r\n***************************************/\r\n\r\nrouter.get('/', (req,res) => {\r\n    \r\n    if(!req.session.error)\r\n        req.session.error = []\r\n\r\n    let language = req.acceptsLanguages('es', 'en')\r\n    if (!language) language = 'en'\r\n    \r\n    if(req.user)\r\n        res.redirect('/home')\r\n    else{\r\n\r\n        let assets = JSON.parse(fs.readFileSync(path.join(__dirname,'../assets/'+language+'.json'),'utf-8'))\r\n\r\n        res.render('index', {\r\n            title: `Cyclon - ${assets.titles.index}`,\r\n            assets: assets, \r\n            path: '/',\r\n            errors: (req.session.error)?req.session.error:[]\r\n        })\r\n    }\r\n    \r\n})\r\n\r\nrouter.get('/privacy', (req,res) => {\r\n    let language = req.acceptsLanguages('es', 'en')\r\n    if (!language) language = 'en'\r\n\r\n    let assets = JSON.parse(fs.readFileSync(path.join(__dirname,'../assets/'+language+'.json'),'utf-8'))\r\n\r\n    res.render('privacy', {\r\n        title: `Cyclon - ${assets.titles.privacy}`, \r\n        path: '/privacy',\r\n        assets: assets\r\n    })\r\n})\r\n\r\nrouter.get('/terms', (req,res) => {\r\n    let language = req.acceptsLanguages('es', 'en')\r\n    if (!language) language = 'en'\r\n\r\n    let assets = JSON.parse(fs.readFileSync(path.join(__dirname,'../assets/'+language+'.json'),'utf-8'))\r\n\r\n    res.render('terms', {\r\n        title: `Cyclon - ${assets.titles.terms}`, \r\n        path: '/terms',\r\n        assets: assets\r\n    })\r\n})\r\n\r\n/***************************************\r\n                    API\r\n***************************************/\r\n\r\nrouter.get('/assets', (req,res) => {\r\n    let language = req.acceptsLanguages('es', 'en')\r\n    if (!language) language = 'en'\r\n    res.send(JSON.parse(fs.readFileSync(path.join(__dirname,'../assets/'+language+'.json'),'utf-8')))\r\n})\r\n\r\n/***************************************\r\n          API Auth Navigator\r\n***************************************/\r\n\r\nrouter.get('/auth/facebook', passport.authenticate('facebook-auth', { authType: 'rerequest', scope:['email']}))\r\n\r\nrouter.get('/auth/facebook/callback', (req, res, next) => {\r\n    passport.authenticate('facebook-auth', function(err, user, info) {\r\n\r\n        if (err){\r\n            req.session.error = err \r\n            return res.redirect('/?action=login')\r\n        }\r\n        if (!user){ \r\n            req.session.error = ['BAD_INPUT']\r\n            return res.redirect('/?action=login') \r\n        }\r\n\r\n        req.logIn(user, function(err) {\r\n            if (err) return next({'code':401,'msg':err})\r\n            req.session.error = []\r\n            req.session.type = user.type\r\n            return res.redirect('/home') \r\n        })\r\n        \r\n    })(req, res, next)\r\n})\r\n\r\nrouter.get('/auth/google',passport.authenticate('google-auth', { scope: ['https://www.googleapis.com/auth/userinfo.profile','https://www.googleapis.com/auth/userinfo.email'] }))\r\n\r\nrouter.get('/auth/google/callback', (req, res, next) => {\r\n    passport.authenticate('google-auth', function(err, user, info) {\r\n        if (err){\r\n            req.session.error = err \r\n            return res.redirect('/?action=login')\r\n        }\r\n        if (!user){ \r\n            req.session.error = ['BAD_INPUT']\r\n            return res.redirect('/?action=login') \r\n        }\r\n\r\n        req.logIn(user, function(err) {\r\n            if (err) return next({'code':401,'msg':err})\r\n            req.session.error = []\r\n            req.session.type = user.type\r\n            return res.redirect('/home') \r\n        })\r\n        \r\n    })(req, res, next)\r\n})\r\n\r\n/***************************************\r\n     API Auth Navigator & Mobile\r\n***************************************/\r\n\r\nrouter.post('/auth/mobile/facebook', (req,res) => {\r\n\r\n    User.find({email: encryptAES(decryptAndroid(req.body.email))}, (err,docs) => {\r\n\r\n        if(err) errorLog.error(err)\r\n\r\n\t\tif(docs.length==0) {\r\n\r\n            const newUser = new User()\r\n            \r\n            let geo = [decryptAndroid(req.body.lat), decryptAndroid(req.body.lng)]\r\n            \r\n\t\t\tif(geo){\r\n\r\n\t\t\t\tlet userObject = newUser.encryptUser(\r\n\t\t\t\t\tdecryptAndroid(req.body.email),\r\n\t\t\t\t\tgeo[0],\r\n\t\t\t\t\tgeo[1],\r\n\t\t\t\t\tdecryptAndroid(req.body.id)\r\n\t\t\t\t)\r\n\t\t\t\r\n\t\t\t\tnewUser.name = decryptAndroid(req.body.name)\r\n\t\t\t\tnewUser.lastName = decryptAndroid(req.body.last_name)\r\n\t\t\t\tnewUser.email = userObject.email\r\n\t\t\t\tnewUser.location.lat = userObject.lat\r\n\t\t\t\tnewUser.location.lng = userObject.lng\r\n\t\t\t\tnewUser.password = userObject.password\r\n                newUser.type = 0\r\n                newUser.register = 1\r\n                newUser.verify = true\r\n\t\t\t\r\n\t\t\t\tnewUser.save()\r\n\t\t\t\tres.json({'code':200,'msg':'ACCOUNT_CREATED'})\r\n\t\t\t}\r\n\t\t\telse\r\n                res.json({'code':401,'msg':'BAD_LOCATION'})\r\n\t\t\t    \t\t\r\n\t\t}\r\n\t\telse\r\n\t\t\tres.json({'code':200,'msg':'LOGIN_SUCCESS'})\r\n\r\n\t})\r\n\r\n})\r\n\r\nrouter.post('/auth/mobile/google', (req,res) => {\r\n\r\n    User.find({email: encryptAES(decryptAndroid(req.body.email))}, (err,docs) => {\r\n\r\n        if(err) errorLog.error(err)\r\n\r\n\t\tif(docs.length==0){\r\n\t\t\tconst newUser = new User()\r\n\r\n            let geo = [decryptAndroid(req.body.lat), decryptAndroid(req.body.lng)]\r\n\r\n            if(geo){\r\n\r\n\t\t\t\tlet userObject = newUser.encryptUser(\r\n\t\t\t\t\tdecryptAndroid(req.body.email),\r\n\t\t\t\t\tgeo[0],\r\n\t\t\t\t\tgeo[1],\r\n\t\t\t\t\tdecryptAndroid(req.body.id)\r\n\t\t\t\t)\r\n\t\t\t\r\n\t\t\t\tnewUser.name = decryptAndroid(req.body.name)\r\n\t\t\t\tnewUser.lastName = decryptAndroid(req.body.last_name)\r\n\t\t\t\tnewUser.email = userObject.email\r\n\t\t\t\tnewUser.location.lat = userObject.lat\r\n\t\t\t\tnewUser.location.lng = userObject.lng\r\n\t\t\t\tnewUser.password = userObject.password\r\n                newUser.type = 0\r\n                newUser.register = 2\r\n                newUser.verify = true\r\n                \r\n\t\t\t\tnewUser.save()\r\n                \r\n                res.json({'code':200,'msg':'ACCOUNT_CREATED'})\r\n                \r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t\tres.json({'code':401,'msg':'BAD_LOCATION'})\r\n\t\t\t     \t\t\r\n\t\t}\r\n\t\telse\r\n\t\t\tres.json({'code':200,'msg':'LOGIN_SUCCESS'})\r\n\r\n\t})\r\n\r\n})\r\n\r\nrouter.post('/auth/mobile/register', (req,res, next) => {\r\n\r\n    let language = req.acceptsLanguages('es', 'en')\r\n    if (!language) language = 'en' \r\n\r\n    req.body.email = encryptFromFront(decryptAndroid(req.body.email))\r\n    req.body.password = encryptFromFront(decryptAndroid(req.body.password))\r\n    req.body.name = encryptFromFront(decryptAndroid(req.body.name))\r\n    req.body.lastName = encryptFromFront(decryptAndroid(req.body.lastName))\r\n\r\n    passport.authenticate('local-signup', function(err, user, info) {\r\n        \r\n        if (err)\r\n            return res.json({'code':401,'msg': err})\r\n        \r\n        if (!user)\r\n            return res.json({'code':401,'msg': ['BAD_INPUT']})\r\n        \r\n\r\n        sendEmail(decryptAES(user.email), 'verification', language, user.name + ' ' + user.lastName, user.type, user.email)\r\n\r\n        req.logIn(user, function(err) {\r\n            if (err) return next(err)\r\n            req.session.type = user.type\r\n            return res.json({'code':200,'msg':'SIGNUP_SUCCESS'})\r\n        })\r\n\r\n    })(req, res, next)\r\n\r\n})\r\n\r\nrouter.post('/auth/mobile/login', (req,res, next) => {\r\n\r\n    let language = req.acceptsLanguages('es', 'en')\r\n    if (!language) language = 'en' \r\n\r\n    req.body.email = encryptFromFront(decryptAndroid(req.body.email))\r\n    req.body.password = encryptFromFront(decryptAndroid(req.body.password))\r\n\r\n    passport.authenticate('local-signin', function(err, user, info) {\r\n        if (err)  return res.send({'code':401,'msg':err})\r\n        if (!user) return res.json({'code':401,'msg':['BAD_INPUT']})\r\n\r\n        req.logIn(user, function(err) {\r\n          if (err) return next({'code':401,'msg':err})\r\n          req.session.type = user.type\r\n          res.cookie('auth', encryptAES(JSON.stringify(user)))\r\n          return res.json({'code':200,'msg':['LOGIN_SUCCESS']})\r\n        })\r\n    })(req, res, next)\r\n\r\n})\r\n\r\nrouter.post('/auth/register', (req, res, next) => {\r\n\r\n    let language = req.acceptsLanguages('es', 'en')\r\n    if (!language) language = 'en' \r\n\r\n    passport.authenticate('local-signup', function(err, user, info) {\r\n        \r\n        if (err)\r\n            return res.json({'code':401,'msg':err})\r\n        \r\n        if (!user)\r\n            return res.json({'code':401,'msg':['BAD_INPUT']})\r\n        \r\n\r\n        sendEmail(decryptAES(user.email), 'verification', language, user.name + ' ' + user.lastName, user.type, user.email)\r\n\r\n        req.logIn(user, function(err) {\r\n            if (err) return next(err)\r\n            req.session.type = user.type\r\n            return res.json({'code':200,'msg':'SIGNUP_SUCCESS'})\r\n        })\r\n\r\n    })(req, res, next)\r\n})\r\n\r\nrouter.post('/auth/login', (req,res,next) => {\r\n    passport.authenticate('local-signin', function(err, user, info) {\r\n        if (err)  return res.send({'code':401,'msg':err})\r\n        if (!user) return res.json({'code':401,'msg':['BAD_INPUT']})\r\n\r\n        req.logIn(user, function(err) {\r\n          if (err) return next({'code':401,'msg':err})\r\n          req.session.type = user.type\r\n          res.cookie('auth', encryptAES(JSON.stringify(user)))\r\n          return res.json({'code':200,'msg':['LOGIN_SUCCESS']})\r\n        })\r\n    })(req, res, next)\r\n})\r\n\r\nrouter.get('/logout', (req, res) => {\r\n    req.session.destroy()\r\n    req.logout()\r\n    res.clearCookie('auth')\r\n    res.redirect('/')\r\n})\r\n\r\nrouter.get('/mapRender', (req,res) => {\r\n    res.render('mapRender')\r\n})\r\n\r\nrouter.get('/mapMobile', (req,res) => {\r\n    let language = req.acceptsLanguages('es', 'en')\r\n    if (!language) language = 'en'\r\n    res.render('MapMobile', {\r\n        assets: JSON.parse(fs.readFileSync(path.join(__dirname,'../assets/'+language+'.json'),'utf-8')),\r\n        path: '/home',\r\n        context: {\r\n            location:{\r\n                lat: encryptAES((19).toString()),\r\n                lng: encryptAES((-99).toString())\r\n            }\r\n        },\r\n        functions: {\r\n            decryptAES\r\n        }\r\n    })\r\n})\r\n\r\nrouter.get('/downloadAPK', (req,res) => {\r\n    res.download(path.join(__dirname,'../assets/Cyclon.apk'))\r\n})\r\n\r\nrouter.get('/twitterMobile', (req,res) => {\r\n    let language = req.acceptsLanguages('es', 'en')\r\n    if (!language) language = 'en'\r\n    res.render('TwitterMobile', {\r\n        assets: JSON.parse(fs.readFileSync(path.join(__dirname,'../assets/'+language+'.json'),'utf-8'))    })\r\n})\r\n\r\nrouter.get('/keepAlive' , (req,res) => {\r\n    res.send('Running')\r\n})\r\n\r\nmodule.exports = router"],"mappings":"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"}