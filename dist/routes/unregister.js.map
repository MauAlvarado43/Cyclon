{"version":3,"sources":["../../src/routes/unregister.js"],"names":["router","get","req","res","language","acceptsLanguages","render","title","assets","JSON","parse","fs","readFileSync","path","join","__dirname","errors","flash","passport","authenticate","authType","scope","next","err","user","info","redirect","post","json","code","logIn","session","destroy","logout","module","exports"],"mappings":"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","file":"unregister.js","sourcesContent":["import {Router} from 'express'\r\nimport passport from 'passport'\r\nimport path from 'path'\r\nimport fs from 'fs'\r\n\r\nconst router = Router()\r\n\r\nrouter.get('/', (req,res) => {\r\n    let language = req.acceptsLanguages('es', 'en')\r\n    if (!language) language = \"en\" \r\n    res.render('index', {title: 'Cyclon', assets: JSON.parse(fs.readFileSync(path.join(__dirname,'../assets/'+language+'.json'),'utf-8')), errors: req.flash('error')})\r\n})\r\n\r\nrouter.get('/auth/facebook', passport.authenticate('facebook-auth', { authType: 'rerequest', scope:['email']}))\r\n\r\nrouter.get('/auth/facebook/callback', (req, res, next) => {\r\n    passport.authenticate('facebook-auth', function(err, user, info) {\r\n        if (err){\r\n            req.flash('error', err) \r\n            return res.redirect(\"/?action=login\")\r\n        }\r\n        if (!user){ \r\n            req.flash('error', [\"BAD_INPUT\"]) \r\n            return res.redirect(\"/?action=login\") \r\n        }\r\n        req.flash('error', []) \r\n        return res.redirect(\"/\") \r\n    })(req, res, next)\r\n})\r\n\r\nrouter.get('/auth/google',passport.authenticate('google-auth', { scope: ['https://www.googleapis.com/auth/userinfo.profile','https://www.googleapis.com/auth/userinfo.email'] }))\r\n\r\nrouter.get('/auth/google/callback', (req, res, next) => {\r\n    passport.authenticate('google-auth', function(err, user, info) {\r\n        if (err){\r\n            req.flash('error', err) \r\n            return res.redirect(\"/?action=login\")\r\n        }\r\n        if (!user){ \r\n            req.flash('error', [\"BAD_INPUT\"]) \r\n            return res.redirect(\"/?action=login\") \r\n        }\r\n        req.flash('error', []) \r\n        return res.redirect(\"/\") \r\n    })(req, res, next)\r\n})\r\n\r\nrouter.post('/auth/register', (req, res, next) => {\r\n    passport.authenticate('local-signup', function(err, user, info) {\r\n        if (err){\r\n            return res.json({code:401,\"msg\":err})\r\n        }\r\n        if (!user){ \r\n            return res.json({code:401,\"msg\":[\"BAD_INPUT\"]})\r\n        }\r\n        return res.json({code:200,\"msg\":[\"SIGNUP_SUCCESS\"]})\r\n    })(req, res, next)\r\n})\r\n\r\nrouter.post('/auth/login', (req,res,next) => {\r\n    passport.authenticate('local-signin', function(err, user, info) {\r\n        if (err)  return next(err)\r\n        if (!user) { return res.json({code:401,\"msg\":\"BAD\"}) }\r\n        req.logIn(user, function(err) {\r\n          if (err) return next(err)\r\n          return res.json({code:200,\"msg\":\"LOGIN_SUCCESS\"})\r\n        })\r\n    })(req, res, next)\r\n})\r\n\r\nrouter.get('/logout', function(req, res){\r\n    req.session.destroy()\r\n    req.logout()\r\n    res.redirect('/')\r\n});\r\n\r\nmodule.exports = router"]}