"use strict";var _express=require("express");var _passport=require("passport");var _passport2=_interopRequireDefault(_passport);var _path=require("path");var _path2=_interopRequireDefault(_path);var _fs=require("fs");var _fs2=_interopRequireDefault(_fs);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var router=(0,_express.Router)();router.get("/",function(req,res){var language=req.acceptsLanguages("es","en");if(!language)language="en";res.render("index",{title:"Cyclon",assets:JSON.parse(_fs2.default.readFileSync(_path2.default.join(__dirname,"../assets/"+language+".json"),"utf-8")),errors:req.flash("error")})});router.get("/auth/facebook",_passport2.default.authenticate("facebook-auth",{authType:"rerequest",scope:["email"]}));router.get("/auth/facebook/callback",function(req,res,next){_passport2.default.authenticate("facebook-auth",function(err,user,info){if(err){req.flash("error",err);return res.redirect("/?action=login")}if(!user){req.flash("error",["BAD_INPUT"]);return res.redirect("/?action=login")}req.flash("error",[]);return res.redirect("/")})(req,res,next)});router.get("/auth/google",_passport2.default.authenticate("google-auth",{scope:["https://www.googleapis.com/auth/userinfo.profile","https://www.googleapis.com/auth/userinfo.email"]}));router.get("/auth/google/callback",function(req,res,next){_passport2.default.authenticate("google-auth",function(err,user,info){if(err){req.flash("error",err);return res.redirect("/?action=login")}if(!user){req.flash("error",["BAD_INPUT"]);return res.redirect("/?action=login")}req.flash("error",[]);return res.redirect("/")})(req,res,next)});router.post("/auth/register",function(req,res,next){_passport2.default.authenticate("local-signup",function(err,user,info){if(err){return res.json({code:401,msg:err})}if(!user){return res.json({code:401,msg:["BAD_INPUT"]})}return res.json({code:200,msg:["SIGNUP_SUCCESS"]})})(req,res,next)});router.post("/auth/login",function(req,res,next){_passport2.default.authenticate("local-signin",function(err,user,info){if(err)return next(err);if(!user){return res.json({code:401,msg:"BAD"})}req.logIn(user,function(err){if(err)return next(err);return res.json({code:200,msg:"LOGIN_SUCCESS"})})})(req,res,next)});router.get("/logout",function(req,res){req.session.destroy();req.logout();res.redirect("/")});module.exports=router;