"use strict";var _express=require("express");var _path=_interopRequireDefault(require("path"));var _fs=_interopRequireDefault(require("fs"));var _UserModel=require("../models/UserModel");var _cipher=require("../utils/cipher");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}module.exports=function(){var router=(0,_express.Router)();router.get("/users",function(req,res){var language=req.acceptsLanguages("es","en");if(!language)language="en";var assets=JSON.parse(_fs["default"].readFileSync(_path["default"].join(__dirname,"../assets/"+language+".json"),"utf-8"));if(!req.user||req.user.type!=2)res.redirect("/");else res.render("users",{title:"Cyclon - ".concat(assets.titles.users),assets:assets,path:"/users",context:req.user})});router.post("/api/upgradeUser",function(req,res){if(!req.user||req.user.type!=2)res.json({code:402,msg:""});else{_UserModel.UserModel.updateOne({email:(0,_cipher.encryptAES)((0,_cipher.decryptFront)(req.body.email))},{$set:{type:2}},function(err,raw){if(err){errorLog.error(err);res.json({code:401,msg:"500"})}else res.json({code:200,msg:"DELETED_SUCCESSFULLY"})})}});router.post("/api/deleteUser",function(req,res){if(!req.user||req.user.type!=2)res.json({code:402,msg:""});else{_UserModel.UserModel.findOne({email:(0,_cipher.encryptAES)((0,_cipher.decryptFront)(req.body.email))},function(err,doc){if(err){console.log(err);res.json({code:401,msg:"500"})}else _UserModel.UserModel.deleteOne({_id:doc._id},function(){if(err){console.log(err);res.json({code:401,msg:"500"})}else res.json({code:200,msg:"DELETED_SUCCESSFULLY"})})})}});return router};