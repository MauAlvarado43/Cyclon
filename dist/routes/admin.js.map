{"version":3,"file":"admin.js","names":["module","exports","router","Router","get","req","res","language","acceptsLanguages","assets","JSON","parse","fs","readFileSync","path","join","__dirname","user","type","redirect","render","title","titles","users","context","post","json","UserModel","updateOne","email","encryptAES","decryptFront","body","$set","err","raw","errorLog","error","findOne","doc","console","log","deleteOne","_id"],"sources":["../../src/routes/admin.js"],"sourcesContent":["import {Router} from 'express'\r\nimport path from 'path'\r\nimport fs from 'fs'\r\nimport { UserModel } from '../models/UserModel'\r\nimport { decryptFront, encryptAES } from '../utils/cipher'\r\n  \r\nmodule.exports = () => {\r\n\r\n    const router = Router()\r\n\r\n    /***************************************\r\n                    Rendering\r\n    ***************************************/\r\n\r\n    router.get('/users', (req,res) => {\r\n        let language = req.acceptsLanguages('es', 'en')\r\n        if (!language) language = 'en' \r\n    \r\n        let assets = JSON.parse(fs.readFileSync(path.join(__dirname,'../assets/'+language+'.json'),'utf-8'))\r\n    \r\n        if(!req.user || req.user.type!=2)\r\n            res.redirect('/')\r\n        else\r\n            res.render('users', {\r\n                title: `Cyclon - ${assets.titles.users}`, \r\n                assets: assets,\r\n                path: '/users',\r\n                context: req.user\r\n            })\r\n    })\r\n\r\n    /***************************************\r\n                     API\r\n    ***************************************/\r\n\r\n   router.post('/api/upgradeUser', (req,res) => {\r\n        if(!req.user || req.user.type!=2)\r\n            res.json({'code': 402, 'msg': ''})\r\n        else{\r\n            UserModel.updateOne({email: encryptAES(decryptFront(req.body.email)) }, {$set: { type: 2 } }, (err,raw) => {\r\n                if(err) {\r\n                    errorLog.error(err)\r\n                    res.json({'code': 401, 'msg': '500'})\r\n                }\r\n                else\r\n                    res.json({'code': 200, 'msg': 'DELETED_SUCCESSFULLY'})\r\n            }) \r\n        }\r\n    })\r\n\r\n    router.post('/api/deleteUser', (req,res) => {\r\n        if(!req.user || req.user.type!=2)\r\n            res.json({'code': 402, 'msg': ''})\r\n        else{\r\n            UserModel.findOne({ email: encryptAES(decryptFront(req.body.email)) }, (err,doc) => {\r\n                if (err){\r\n                    console.log(err)\r\n                    res.json({'code': 401, 'msg': '500'})\r\n                }\r\n                else\r\n                    UserModel.deleteOne({_id: doc._id}, () => {\r\n                        if (err) {\r\n                            console.log(err)\r\n                            res.json({'code': 401, 'msg': '500'})\r\n                        }\r\n                        else\r\n                        res.json({'code': 200, 'msg': 'DELETED_SUCCESSFULLY'})\r\n                    })\r\n            })\r\n        }\r\n    })\r\n\r\n    return router\r\n\r\n}"],"mappings":"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"}