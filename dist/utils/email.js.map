{"version":3,"file":"email.js","names":["sendEmail","destiny","topic","language","name","level","_id","assets","JSON","parse","fs","readFileSync","path","join","__dirname","transporter","nodemailer","createTransport","service","host","port","secure","auth","user","pass","tls","rejectUnauthorized","mailOptions","from","to","subject","html","getHTML","attachments","filename","cid","sendMail","err","info","console","log","errorLog","error","replace","verification","text","split","process","env","URL","generateToken","encryptAES","recover"],"sources":["../../src/utils/email.js"],"sourcesContent":["import nodemailer from 'nodemailer'\r\nimport { errorLog } from './logger'\r\nimport path from 'path'\r\nimport fs from 'fs'\r\nimport { generateToken, encryptAES } from './cipher'\r\n\r\nconst sendEmail = (destiny, topic, language, name, level, _id) => {\r\n\r\n    try{\r\n\r\n        let assets = (JSON.parse(fs.readFileSync(path.join(__dirname,'../assets/emails.json'),'utf-8')))\r\n\r\n        let transporter = nodemailer.createTransport({\r\n            service: 'Gmail',\r\n            host: 'smtp.gmail.com',\r\n            port: 465,\r\n            secure: true,\r\n            auth: {\r\n                user: 'hypersoftcode@gmail.com',\r\n                pass: 'a3*/dac34&ew3$'\r\n            },\r\n            tls: {\r\n                rejectUnauthorized: false\r\n            }\r\n        })\r\n        \r\n        let mailOptions = {\r\n            from: 'hypersoftcode@gmail.com',\r\n            to: destiny,\r\n            subject: assets[language][topic].subject,\r\n            html: getHTML(topic, assets, name, level, language, _id),\r\n            attachments: \r\n            [\r\n                {\r\n                filename: 'CyclonHeader.png',\r\n                path: 'src/public/images/CyclonHeader.png',\r\n                cid: 'logo'\r\n                },\r\n                {\r\n                    filename: 'app-store-us.png',\r\n                    path: 'src/public/images/app-store-us.png',\r\n                    cid: 'appstore'\r\n                },\r\n                {\r\n                    filename: 'google-play-us.png',\r\n                    path: 'src/public/images/google-play-us.png',\r\n                    cid: 'googleplay'\r\n                },\r\n                {\r\n                    filename: 'twitter2x.png',\r\n                    path: 'src/public/images/twitter2x.png',\r\n                    cid: 'twitter'\r\n                },\r\n                {\r\n                    filename: 'facebook2x.png',\r\n                    path: 'src/public/images/facebook2x.png',\r\n                    cid: 'facebook'\r\n                },\r\n\r\n            ]\r\n        }\r\n\r\n        if (language == 'es'){\r\n            mailOptions.attachments[1] = {\r\n                filename: 'app-store-es.png',\r\n                path: 'src/public/images/app-store-es.png',\r\n                cid: 'appstore'\r\n            }\r\n            mailOptions.attachments[2] = {\r\n                filename: 'google-play-es.png',\r\n                path: 'src/public/images/google-play-es.png',\r\n                cid: 'googleplay'\r\n            }\r\n        }\r\n\r\n        transporter.sendMail(mailOptions, function(err, info){\r\n            if (err){\r\n                console.log(err)\r\n            }\r\n        })\r\n\r\n    }catch(err){\r\n        console.log(err)\r\n        errorLog.error(err)\r\n    }\r\n\r\n}\r\n\r\nconst getHTML = (topic, assets, name, level, language, _id) => {\r\n\r\n    if (topic == 'verification'){\r\n        let html = fs.readFileSync(path.join(__dirname,'./templates/verification.html'),'utf-8')\r\n        .replace('$(0)', name)\r\n        .replace('$(1)',assets[language].verification.text[0])\r\n        .replace('$(2)',assets[language].level[level])\r\n        .replace('$(3)',assets[language].verification.text[1])\r\n        .replace('$(4)', name.split(' ')[0] + ' !')\r\n        .replace('$(5)',assets[language].verification.text[2])\r\n        .replace('$(6)',assets[language].verification.text[3])\r\n        .replace('$(7)',assets[language].verification.text[4])\r\n        .replace('$(8)',assets[language].verification.text[5])\r\n        .replace('$(9)',assets[language].verification.text[6])\r\n        .replace('$(10',assets[language].verification.text[7])\r\n        .replace('$(11)',assets[language].verification.text[8])\r\n        .replace('$(link)', 'href=\\\"'+ process.env.URL + '/verifyAccount?v='+generateToken((60 * 60 * 24 * 365))+'&u='+encryptAES(_id)+'\\\"')\r\n        return html\r\n    }\r\n    else if(topic == 'recover'){\r\n        let html = fs.readFileSync(path.join(__dirname,'./templates/verification.html'),'utf-8')\r\n        .replace('$(0)', name)\r\n        .replace('$(1)',assets[language].recover.text[0])\r\n        .replace('$(2)',assets[language].level[level])\r\n        .replace('$(3)',assets[language].recover.text[1])\r\n        .replace('$(4)', name.split(' ')[0] + ' !')\r\n        .replace('$(5)',assets[language].recover.text[2])\r\n        .replace('$(6)',assets[language].recover.text[3])\r\n        .replace('$(7)',assets[language].recover.text[4])\r\n        .replace('$(8)',assets[language].recover.text[5])\r\n        .replace('$(9)',assets[language].recover.text[6])\r\n        .replace('$(10',assets[language].recover.text[7])\r\n        .replace('$(11)',assets[language].recover.text[8])\r\n        .replace('$(link)', 'href=\\\"'+ process.env.URL + '/recoverPassword?v='+generateToken((60 * 60 * 24))+'&u='+encryptAES(_id)+'\\\"')\r\n        return html\r\n    }\r\n\r\n}\r\n\r\nexport { sendEmail }"],"mappings":"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"}