"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.sendEmail=void 0;var _nodemailer=_interopRequireDefault(require("nodemailer"));var _logger=require("./logger");var _path=_interopRequireDefault(require("path"));var _fs=_interopRequireDefault(require("fs"));var _cipher=require("./cipher");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}var sendEmail=function sendEmail(destiny,topic,language,name,level,_id){try{var assets=JSON.parse(_fs["default"].readFileSync(_path["default"].join(__dirname,"../assets/emails.json"),"utf-8"));var transporter=_nodemailer["default"].createTransport({service:"Gmail",host:"smtp.gmail.com",port:465,secure:true,auth:{user:"hypersoftcode@gmail.com",pass:"a3*/dac34&ew3$"},tls:{rejectUnauthorized:false}});var mailOptions={from:"hypersoftcode@gmail.com",to:destiny,subject:assets[language][topic].subject,html:getHTML(topic,assets,name,level,language,_id),attachments:[{filename:"CyclonHeader.png",path:"src/public/images/CyclonHeader.png",cid:"logo"},{filename:"app-store-us.png",path:"src/public/images/app-store-us.png",cid:"appstore"},{filename:"google-play-us.png",path:"src/public/images/google-play-us.png",cid:"googleplay"},{filename:"twitter2x.png",path:"src/public/images/twitter2x.png",cid:"twitter"},{filename:"facebook2x.png",path:"src/public/images/facebook2x.png",cid:"facebook"}]};if(language=="es"){mailOptions.attachments[1]={filename:"app-store-es.png",path:"src/public/images/app-store-es.png",cid:"appstore"};mailOptions.attachments[2]={filename:"google-play-es.png",path:"src/public/images/google-play-es.png",cid:"googleplay"}}transporter.sendMail(mailOptions,function(err,info){if(err){console.log(err)}})}catch(err){console.log(err);_logger.errorLog.error(err)}};exports.sendEmail=sendEmail;var getHTML=function getHTML(topic,assets,name,level,language,_id){if(topic=="verification"){var html=_fs["default"].readFileSync(_path["default"].join(__dirname,"./templates/verification.html"),"utf-8").replace("$(0)",name).replace("$(1)",assets[language].verification.text[0]).replace("$(2)",assets[language].level[level]).replace("$(3)",assets[language].verification.text[1]).replace("$(4)",name.split(" ")[0]+" !").replace("$(5)",assets[language].verification.text[2]).replace("$(6)",assets[language].verification.text[3]).replace("$(7)",assets[language].verification.text[4]).replace("$(8)",assets[language].verification.text[5]).replace("$(9)",assets[language].verification.text[6]).replace("$(10",assets[language].verification.text[7]).replace("$(11)",assets[language].verification.text[8]).replace("$(link)",'href="'+process.env.URL+"/verifyAccount?v="+(0,_cipher.generateToken)(60*60*24*365)+"&u="+(0,_cipher.encryptAES)(_id)+'"');return html}else if(topic=="recover"){var _html=_fs["default"].readFileSync(_path["default"].join(__dirname,"./templates/verification.html"),"utf-8").replace("$(0)",name).replace("$(1)",assets[language].recover.text[0]).replace("$(2)",assets[language].level[level]).replace("$(3)",assets[language].recover.text[1]).replace("$(4)",name.split(" ")[0]+" !").replace("$(5)",assets[language].recover.text[2]).replace("$(6)",assets[language].recover.text[3]).replace("$(7)",assets[language].recover.text[4]).replace("$(8)",assets[language].recover.text[5]).replace("$(9)",assets[language].recover.text[6]).replace("$(10",assets[language].recover.text[7]).replace("$(11)",assets[language].recover.text[8]).replace("$(link)",'href="'+process.env.URL+"/recoverPassword?v="+(0,_cipher.generateToken)(60*60*24)+"&u="+(0,_cipher.encryptAES)(_id)+'"');return _html}};