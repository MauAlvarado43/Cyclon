{"version":3,"file":"socket.js","names":["generateTweet","data","puppeteer","launch","args","browser","newPage","page","setViewport","width","height","process","env","URL","lastPoint","position","lat","lng","category","waitFor","screenshot","path","join","__dirname","fullPage","close","wind","fs","readFileSync","temp","clouds","pressure","message","name","nearest","distance","city","makeTweetWithImages","module","exports","http","io","ioServer","client","ioClient","PYTHON_URL","on","socket","console","log","emit","update"],"sources":["../../src/config/socket.js"],"sourcesContent":["import ioClient from 'socket.io-client'\r\nimport ioServer from 'socket.io'\r\nimport puppeteer from 'puppeteer'\r\nimport fs from 'fs'\r\nimport path from 'path'\r\nimport { makeTweetWithImages } from '../utils/twitter'\r\n\r\nconst generateTweet = async (data) => {\r\n                        \r\n    const browser = await puppeteer.launch({args: ['--no-sandbox', '--disable-setuid-sandbox']})\r\n    const page = await browser.newPage()\r\n\r\n    await page.setViewport({ width: 1280, height: 800 })\r\n    await page.goto(process.env.URL+\"/mapRender?lat=\"+data.lastPoint.position.lat+\"&lng=\"+data.lastPoint.position.lng+\"&cat=\"+data.category)\r\n\r\n    await page.waitFor(6000)\r\n    await page.screenshot({ path: path.join(__dirname,'../assets/wind.png'), fullPage: true })\r\n\r\n    await page.waitFor(4500)\r\n    await page.screenshot({ path: path.join(__dirname,'../assets/temp.png'), fullPage: true })\r\n\r\n    await page.waitFor(4500)\r\n    await page.screenshot({ path: path.join(__dirname,'../assets/clouds.png'), fullPage: true })\r\n\r\n    await page.waitFor(4500)\r\n    await page.screenshot({ path: path.join(__dirname,'../assets/pressure.png'), fullPage: true })\r\n\r\n    await browser.close()\r\n\r\n    let wind = fs.readFileSync(path.join(__dirname,'../assets/wind.png'))\r\n    let temp = fs.readFileSync(path.join(__dirname,'../assets/temp.png'))\r\n    let clouds = fs.readFileSync(path.join(__dirname,'../assets/clouds.png'))\r\n    let pressure = fs.readFileSync(path.join(__dirname,'../assets/pressure.png'))\r\n\r\n    let message = ''\r\n    let category = ''\r\n\r\n    if(data.category == 'DT')\r\n        category = 'la depresión tropical'\r\n    else if(data.category == 'TT')\r\n        category = 'la tormenta tropical'\r\n    else \r\n        category = 'el huracán'\r\n\r\n    message = `Se ha detectado ${category} ` + data.name + \" a \" + data.nearest.distance + \" km de \" + data.nearest.city\r\n\r\n    makeTweetWithImages([ wind, temp, clouds, pressure], message)\r\n\r\n}\r\n\r\nmodule.exports = (http) => {\r\n\r\n    const io = ioServer(http)\r\n    const client = ioClient(process.env.PYTHON_URL + '/api')\r\n\r\n    io.on('connection', (socket) => {\r\n\r\n    })\r\n\r\n    client.on('connect', () => {\r\n        console.log(\"CONNECTED\")\r\n    })\r\n\r\n    client.on('/alert', (data) => {\r\n\r\n        io.emit('/alert', {\r\n            data\r\n        })\r\n        \r\n        if(!data.update)\r\n            generateTweet(data.data)\r\n            \r\n    })\r\n    \r\n    client.on('disconnect', () => {\r\n        console.log(\"DISCONNECTED\")\r\n    })\r\n\r\n    return io\r\n    \r\n}"],"mappings":"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"}