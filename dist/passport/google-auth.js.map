{"version":3,"sources":["../../src/passport/google-auth.js"],"names":["passport","use","GoogleStrategy","clientID","clientSecret","callbackURL","process","env","URL","passReqToCallback","req","accessToken","refreshToken","profile","done","User","find","email","emails","value","err","docs","errorLog","error","length","newUser","geo","geoip","lookup","ip","userObject","encryptUser","ll","id","name","givenName","lastName","familyName","location","lat","lng","password","type","verify","save"],"mappings":";;AAAA;;;;AACA;;AACA;;AACA;;AACA;;;;AACA;;;;;;AAGAA,mBAASC,GAAT,CAAa,aAAb,EAA2B,IAAIC,mCAAJ,CAAmB;AACtCC,cAAU,0EAD4B;AAEtCC,kBAAc,0BAFwB;AAGtCC,iBAAaC,QAAQC,GAAR,CAAYC,GAAZ,GAAkB,uBAHO;AAItCC,uBAAmB;AAJmB,CAAnB;AAAA,uEAKpB,iBAAOC,GAAP,EAAYC,WAAZ,EAAyBC,YAAzB,EAAuCC,OAAvC,EAAgDC,IAAhD;AAAA;AAAA;AAAA;AAAA;;AAECC,6CAAKC,IAAL,CAAU,EAACC,OAAO,wBAAWJ,QAAQK,MAAR,CAAe,CAAf,EAAkBC,KAA7B,CAAR,EAAV,EAAwD,UAACC,GAAD,EAAKC,IAAL,EAAc;;AAElE,gCAAGD,GAAH,EAAQE,iBAASC,KAAT,CAAeH,GAAf;;AAER,gCAAGC,KAAKG,MAAL,IAAa,CAAhB,EAAkB;AACd,oCAAMC,UAAU,IAAIV,oBAAJ,EAAhB;;AAEA,oCAAIW,MAAMC,oBAAMC,MAAN,CAAalB,IAAImB,EAAjB,CAAV;;AAEA,oCAAGH,GAAH,EAAO;;AAEH,wCAAII,aAAaL,QAAQM,WAAR,CACblB,QAAQK,MAAR,CAAe,CAAf,EAAkBC,KADL,EAEbO,IAAIM,EAAJ,CAAO,CAAP,CAFa,EAGbN,IAAIM,EAAJ,CAAO,CAAP,CAHa,EAIbnB,QAAQoB,EAJK,CAAjB;;AAOAR,4CAAQS,IAAR,GAAerB,QAAQqB,IAAR,CAAaC,SAA5B;AACAV,4CAAQW,QAAR,GAAmBvB,QAAQqB,IAAR,CAAaG,UAAhC;AACAZ,4CAAQR,KAAR,GAAgBa,WAAWb,KAA3B;AACAQ,4CAAQa,QAAR,CAAiBC,GAAjB,GAAuBT,WAAWS,GAAlC;AACAd,4CAAQa,QAAR,CAAiBE,GAAjB,GAAuBV,WAAWU,GAAlC;AACAf,4CAAQgB,QAAR,GAAmBX,WAAWW,QAA9B;AACAhB,4CAAQiB,IAAR,GAAe,CAAf;AACAjB,4CAAQkB,MAAR,GAAiB,IAAjB;;AAEAlB,4CAAQmB,IAAR;AACA9B,yCAAK,IAAL,EAAWW,OAAX;AACH,iCApBD,MAqBI;AACA,2CAAOX,KAAK,CAAC,cAAD,CAAL,EAAuB,KAAvB,CAAP;AACH;AAEJ,6BA9BD,MA+BI;AACAA,qCAAK,IAAL,EAAWO,KAAK,CAAL,CAAX;AACH;AAEJ,yBAvCD;;AAFD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KALoB;;AAAA;AAAA;AAAA;AAAA,IAA3B","file":"google-auth.js","sourcesContent":["import passport from 'passport'\r\nimport {OAuth2Strategy as GoogleStrategy} from 'passport-google-oauth'\r\nimport {UserModel as User} from '../models/UserModel'\r\nimport {encryptAES} from '../utils/cipher'\r\nimport geoip from 'geoip-lite'\r\nimport { errorLog } from '../utils/logger'\r\n\r\n\r\npassport.use('google-auth',new GoogleStrategy({\r\n        clientID: '155001320669-kd32n0gk5u8le64bbmtie7d2ebvfujot.apps.googleusercontent.com',\r\n        clientSecret: 'KAOYHF3jiEHKco7qDSGQ5frg',\r\n        callbackURL: process.env.URL + '/auth/google/callback',\r\n        passReqToCallback: true\r\n    }, async (req, accessToken, refreshToken, profile, done) => {\r\n\r\n        User.find({email: encryptAES(profile.emails[0].value)}, (err,docs) => {\r\n\r\n            if(err) errorLog.error(err)\r\n\r\n            if(docs.length==0){\r\n                const newUser = new User()\r\n\r\n                let geo = geoip.lookup(req.ip)\r\n\r\n                if(geo){\r\n                    \r\n                    let userObject = newUser.encryptUser(\r\n                        profile.emails[0].value,\r\n                        geo.ll[0],\r\n                        geo.ll[1],\r\n                        profile.id\r\n                    )\r\n                \r\n                    newUser.name = profile.name.givenName\r\n                    newUser.lastName = profile.name.familyName\r\n                    newUser.email = userObject.email\r\n                    newUser.location.lat = userObject.lat\r\n                    newUser.location.lng = userObject.lng\r\n                    newUser.password = userObject.password\r\n                    newUser.type = 0\r\n                    newUser.verify = true\r\n                \r\n                    newUser.save()\r\n                    done(null, newUser)\r\n                }\r\n                else{\r\n                    return done(['BAD_LOCATION'], false)\r\n                }  \r\n\r\n            }\r\n            else{\r\n                done(null, docs[0])\r\n            }\r\n\r\n        })\r\n    }\r\n\r\n))"]}