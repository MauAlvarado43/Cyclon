{"version":3,"file":"google-auth.js","names":["passport","use","GoogleStrategy","clientID","clientSecret","callbackURL","process","env","URL","passReqToCallback","req","accessToken","refreshToken","profile","done","User","find","email","encryptAES","emails","value","err","docs","errorLog","error","length","newUser","geo","geoip","lookup","clientIp","userObject","encryptUser","ll","id","name","givenName","lastName","familyName","location","lat","lng","password","type","verify","register","dateRegister","Date","save"],"sources":["../../src/passport/google-auth.js"],"sourcesContent":["import passport from 'passport'\r\nimport {OAuth2Strategy as GoogleStrategy} from 'passport-google-oauth'\r\nimport {UserModel as User} from '../models/UserModel'\r\nimport {encryptAES} from '../utils/cipher'\r\nimport geoip from 'geoip-lite'\r\nimport { errorLog } from '../utils/logger'\r\n\r\npassport.use('google-auth',new GoogleStrategy({\r\n    clientID: '527371050470-3p8l2gkuubnf79dr7j2tr2g5cknepv8b.apps.googleusercontent.com',\r\n    clientSecret: '--JD-kizC2X9oJsvgdmWZWbq',\r\n    callbackURL: process.env.URL + '/auth/google/callback',\r\n    passReqToCallback: true\r\n}, async (req, accessToken, refreshToken, profile, done) => {\r\n\r\n        User.find({email: encryptAES(profile.emails[0].value)}, async (err,docs) => {\r\n\r\n            if(err) errorLog.error(err)\r\n\r\n            if(docs.length==0){\r\n                const newUser = new User()\r\n\r\n                let geo = geoip.lookup(req.clientIp)\r\n\r\n                if(geo){\r\n                    \r\n                    let userObject = newUser.encryptUser(\r\n                        profile.emails[0].value,\r\n                        geo.ll[0],\r\n                        geo.ll[1],\r\n                        profile.id\r\n                    )\r\n                \r\n                    newUser.name = profile.name.givenName\r\n                    newUser.lastName = profile.name.familyName\r\n                    newUser.email = userObject.email\r\n                    newUser.location.lat = userObject.lat\r\n                    newUser.location.lng = userObject.lng\r\n                    newUser.password = userObject.password\r\n                    newUser.type = 0\r\n                    newUser.verify = true\r\n                    newUser.register = 2\r\n                    newUser.dateRegister = new Date()\r\n                \r\n                    await newUser.save()\r\n\r\n                    done(null, newUser)\r\n                }\r\n                else{\r\n                    return done(['BAD_LOCATION'], false)\r\n                }  \r\n\r\n            }\r\n            else{\r\n                done(null, docs[0])\r\n            }\r\n\r\n        })\r\n    }\r\n\r\n))\r\n"],"mappings":";;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;+CAJA,oJ;;;;;;AAMAA,oBAAA,CAASC,GAAT,CAAa,aAAb,EAA2B,IAAIC,mCAAJ,CAAmB;EAC1CC,QAAQ,EAAE,0EADgC;EAE1CC,YAAY,EAAE,0BAF4B;EAG1CC,WAAW,EAAEC,OAAO,CAACC,GAAR,CAAYC,GAAZ,GAAkB,uBAHW;EAI1CC,iBAAiB,EAAE;AAJuB,CAAnB;EAAA,sEAKxB,kBAAOC,GAAP,EAAYC,WAAZ,EAAyBC,YAAzB,EAAuCC,OAAvC,EAAgDC,IAAhD;IAAA;MAAA;QAAA;UAAA;YAEKC,oBAAA,CAAKC,IAAL,CAAU;cAACC,KAAK,EAAE,IAAAC,kBAAA,EAAWL,OAAO,CAACM,MAAR,CAAe,CAAf,EAAkBC,KAA7B;YAAR,CAAV;cAAA,uEAAwD,iBAAOC,GAAP,EAAWC,IAAX;gBAAA;gBAAA;kBAAA;oBAAA;sBAAA;wBAEpD,IAAGD,GAAH,EAAQE,gBAAA,CAASC,KAAT,CAAeH,GAAf;;wBAF4C,MAIjDC,IAAI,CAACG,MAAL,IAAa,CAJoC;0BAAA;0BAAA;wBAAA;;wBAK1CC,OAL0C,GAKhC,IAAIX,oBAAJ,EALgC;wBAO5CY,GAP4C,GAOtCC,qBAAA,CAAMC,MAAN,CAAanB,GAAG,CAACoB,QAAjB,CAPsC;;wBAAA,KAS7CH,GAT6C;0BAAA;0BAAA;wBAAA;;wBAWxCI,UAXwC,GAW3BL,OAAO,CAACM,WAAR,CACbnB,OAAO,CAACM,MAAR,CAAe,CAAf,EAAkBC,KADL,EAEbO,GAAG,CAACM,EAAJ,CAAO,CAAP,CAFa,EAGbN,GAAG,CAACM,EAAJ,CAAO,CAAP,CAHa,EAIbpB,OAAO,CAACqB,EAJK,CAX2B;wBAkB5CR,OAAO,CAACS,IAAR,GAAetB,OAAO,CAACsB,IAAR,CAAaC,SAA5B;wBACAV,OAAO,CAACW,QAAR,GAAmBxB,OAAO,CAACsB,IAAR,CAAaG,UAAhC;wBACAZ,OAAO,CAACT,KAAR,GAAgBc,UAAU,CAACd,KAA3B;wBACAS,OAAO,CAACa,QAAR,CAAiBC,GAAjB,GAAuBT,UAAU,CAACS,GAAlC;wBACAd,OAAO,CAACa,QAAR,CAAiBE,GAAjB,GAAuBV,UAAU,CAACU,GAAlC;wBACAf,OAAO,CAACgB,QAAR,GAAmBX,UAAU,CAACW,QAA9B;wBACAhB,OAAO,CAACiB,IAAR,GAAe,CAAf;wBACAjB,OAAO,CAACkB,MAAR,GAAiB,IAAjB;wBACAlB,OAAO,CAACmB,QAAR,GAAmB,CAAnB;wBACAnB,OAAO,CAACoB,YAAR,GAAuB,IAAIC,IAAJ,EAAvB;wBA3B4C;wBAAA,OA6BtCrB,OAAO,CAACsB,IAAR,EA7BsC;;sBAAA;wBA+B5ClC,IAAI,CAAC,IAAD,EAAOY,OAAP,CAAJ;wBA/B4C;wBAAA;;sBAAA;wBAAA,iCAkCrCZ,IAAI,CAAC,CAAC,cAAD,CAAD,EAAmB,KAAnB,CAlCiC;;sBAAA;wBAAA;wBAAA;;sBAAA;wBAuChDA,IAAI,CAAC,IAAD,EAAOQ,IAAI,CAAC,CAAD,CAAX,CAAJ;;sBAvCgD;sBAAA;wBAAA;oBAAA;kBAAA;gBAAA;cAAA,CAAxD;;cAAA;gBAAA;cAAA;YAAA;;UAFL;UAAA;YAAA;QAAA;MAAA;IAAA;EAAA,CALwB;;EAAA;IAAA;EAAA;AAAA,IAA3B"}