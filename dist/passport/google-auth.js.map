{"version":3,"sources":["../../src/passport/google-auth.js"],"names":["passport","use","GoogleStrategy","clientID","clientSecret","callbackURL","passReqToCallback","req","accessToken","refreshToken","profile","done","User","find","email","emails","value","err","docs","console","log","length","newUser","geo","geoip","lookup","ip","ll","userObject","encryptUser","id","name","givenName","lastName","familyName","lat","lng","password","type"],"mappings":";;AAAA;;;;AACA;;AACA;;AACA;;;;;;;;AAEAA,mBAASC,GAAT,CAAa,aAAb,EAA2B,IAAIC,mCAAJ,CAAmB;AACtCC,cAAU,0EAD4B;AAEtCC,kBAAc,0BAFwB;AAGtCC,iBAAa,4CAHyB;AAItCC,uBAAmB;AAJmB,CAAnB;AAAA,uEAKpB,iBAAOC,GAAP,EAAYC,WAAZ,EAAyBC,YAAzB,EAAuCC,OAAvC,EAAgDC,IAAhD;AAAA;AAAA;AAAA;AAAA;;AAECC,6CAAKC,IAAL,CAAU,EAACC,OAAOJ,QAAQK,MAAR,CAAe,CAAf,EAAkBC,KAA1B,EAAV,EAA4C,UAACC,GAAD,EAAKC,IAAL,EAAc;;AAEtDC,oCAAQC,GAAR,CAAYF,IAAZ;;AAEA,gCAAGA,KAAKG,MAAL,IAAa,CAAhB,EAAkB;AACd,oCAAMC,UAAU,IAAIV,oBAAJ,EAAhB;;AAEA,oCAAIW,MAAMC,oBAAMC,MAAN,CAAalB,IAAImB,EAAjB,CAAV;;AAEAP,wCAAQC,GAAR,CAAYG,IAAII,EAAhB;;AAEA,oCAAGJ,GAAH,EAAO;;AAEH,wCAAIK,aAAaN,QAAQO,WAAR,CACbnB,QAAQK,MAAR,CAAe,CAAf,EAAkBC,KADL,EAEbO,IAAII,EAAJ,CAAO,CAAP,CAFa,EAGbJ,IAAII,EAAJ,CAAO,CAAP,CAHa,EAIbjB,QAAQoB,EAJK,CAAjB;;AAOAR,4CAAQS,IAAR,GAAerB,QAAQqB,IAAR,CAAaC,SAA5B;AACAV,4CAAQW,QAAR,GAAmBvB,QAAQqB,IAAR,CAAaG,UAAhC;AACAZ,4CAAQR,KAAR,GAAgBc,WAAWd,KAA3B;AACAQ,4CAAQa,GAAR,GAAcP,WAAWO,GAAzB;AACAb,4CAAQc,GAAR,GAAcR,WAAWQ,GAAzB;AACAd,4CAAQe,QAAR,GAAmBT,WAAWS,QAA9B;AACAf,4CAAQgB,IAAR,GAAe,CAAf;;AAEAnB,4CAAQC,GAAR,CAAYE,OAAZ;;AAEA;AACAX,yCAAK,IAAL,EAAWW,OAAX;AACH,iCArBD,MAsBI;AACA,2CAAOX,KAAK,CAAC,cAAD,CAAL,EAAuB,KAAvB,CAAP;AACH;AAEJ,6BAjCD,MAkCI;AACAA,qCAAK,IAAL,EAAWO,KAAK,CAAL,CAAX;AACH;AAEJ,yBA1CD;;AAFD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KALoB;;AAAA;AAAA;AAAA;AAAA,IAA3B","file":"google-auth.js","sourcesContent":["import passport from 'passport'\r\nimport {OAuth2Strategy as GoogleStrategy} from 'passport-google-oauth'\r\nimport {UserModel as User} from '../models/UserModel'\r\nimport geoip from 'geoip-lite'\r\n\r\npassport.use('google-auth',new GoogleStrategy({\r\n        clientID: \"155001320669-kd32n0gk5u8le64bbmtie7d2ebvfujot.apps.googleusercontent.com\",\r\n        clientSecret: \"KAOYHF3jiEHKco7qDSGQ5frg\",\r\n        callbackURL: \"http://localhost:3000/auth/google/callback\",\r\n        passReqToCallback: true\r\n    }, async (req, accessToken, refreshToken, profile, done) => {\r\n\r\n        User.find({email: profile.emails[0].value}, (err,docs) => {\r\n\r\n            console.log(docs)\r\n\r\n            if(docs.length==0){\r\n                const newUser = new User()\r\n\r\n                let geo = geoip.lookup(req.ip)\r\n\r\n                console.log(geo.ll)\r\n\r\n                if(geo){\r\n                    \r\n                    let userObject = newUser.encryptUser(\r\n                        profile.emails[0].value,\r\n                        geo.ll[0],\r\n                        geo.ll[1],\r\n                        profile.id\r\n                    )\r\n                \r\n                    newUser.name = profile.name.givenName\r\n                    newUser.lastName = profile.name.familyName\r\n                    newUser.email = userObject.email\r\n                    newUser.lat = userObject.lat\r\n                    newUser.lng = userObject.lng\r\n                    newUser.password = userObject.password\r\n                    newUser.type = 0\r\n\r\n                    console.log(newUser)\r\n                \r\n                    //newUser.save()\r\n                    done(null, newUser)\r\n                }\r\n                else{\r\n                    return done([\"BAD_LOCATION\"], false)\r\n                }  \r\n\r\n            }\r\n            else{\r\n                done(null, docs[0])\r\n            }\r\n\r\n        })\r\n    }\r\n\r\n))"]}