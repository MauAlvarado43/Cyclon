{"version":3,"sources":["../../src/passport/facebook-auth.js"],"names":["passport","use","FacebookStrategy","clientID","clientSecret","callbackURL","passReqToCallback","profileFields","req","accessToken","refreshToken","profile","done","User","find","email","emails","value","err","docs","console","log","length","newUser","geo","geoip","lookup","ip","userObject","encryptUser","ll","id","name","givenName","lastName","familyName","lat","lng","password","type","save"],"mappings":";;AAAA;;;;AACA;;AACA;;AACA;;;;;;;;AAEAA,mBAASC,GAAT,CAAa,eAAb,EAA6B,IAAIC,0BAAJ,CAAqB;AAC9CC,WAAU,kBADoC;AAE9CC,eAAc,kCAFgC;AAG9CC,cAAa,8CAHiC;AAI9CC,oBAAmB,IAJ2B;AAK9CC,gBAAe,CAAC,IAAD,EAAO,OAAP,EAAgB,YAAhB,EAA8B,WAA9B;AAL+B,CAArB;AAAA,oEAMzB,iBAAOC,GAAP,EAAYC,WAAZ,EAAyBC,YAAzB,EAAuCC,OAAvC,EAAgDC,IAAhD;AAAA;AAAA;AAAA;AAAA;;AAEAC,2BAAKC,IAAL,CAAU,EAACC,OAAOJ,QAAQK,MAAR,CAAe,CAAf,EAAkBC,KAA1B,EAAV,EAA4C,UAACC,GAAD,EAAKC,IAAL,EAAc;;AAEtDC,eAAQC,GAAR,CAAYF,IAAZ;;AAEN,WAAGA,KAAKG,MAAL,IAAa,CAAhB,EAAkB;AACjB,YAAMC,UAAU,IAAIV,oBAAJ,EAAhB;;AAEA,YAAIW,MAAMC,oBAAMC,MAAN,CAAalB,IAAImB,EAAjB,CAAV;;AAEA,YAAGH,GAAH,EAAO;;AAEN,aAAII,aAAaL,QAAQM,WAAR,CAChBlB,QAAQK,MAAR,CAAe,CAAf,EAAkBC,KADF,EAEhBO,IAAIM,EAAJ,CAAO,CAAP,CAFgB,EAGhBN,IAAIM,EAAJ,CAAO,CAAP,CAHgB,EAIhBnB,QAAQoB,EAJQ,CAAjB;;AAOAR,iBAAQS,IAAR,GAAerB,QAAQqB,IAAR,CAAaC,SAA5B;AACAV,iBAAQW,QAAR,GAAmBvB,QAAQqB,IAAR,CAAaG,UAAhC;AACAZ,iBAAQR,KAAR,GAAgBa,WAAWb,KAA3B;AACAQ,iBAAQa,GAAR,GAAcR,WAAWQ,GAAzB;AACAb,iBAAQc,GAAR,GAAcT,WAAWS,GAAzB;AACAd,iBAAQe,QAAR,GAAmBV,WAAWU,QAA9B;AACAf,iBAAQgB,IAAR,GAAe,CAAf;;AAEAnB,iBAAQC,GAAR,CAAYE,OAAZ;;AAEAA,iBAAQiB,IAAR;AACA5B,cAAK,IAAL,EAAWW,OAAX;AACA,SArBD,MAsBI;AACH,gBAAOX,KAAK,CAAC,cAAD,CAAL,EAAuB,KAAvB,CAAP;AACA;AACD,QA9BD,MA+BI;AACHA,aAAK,IAAL,EAAWO,KAAK,CAAL,CAAX;AACA;AAED,OAvCE;;AAFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EANyB;;AAAA;AAAA;AAAA;AAAA,IAA7B","file":"facebook-auth.js","sourcesContent":["import passport from 'passport'\r\nimport {Strategy as FacebookStrategy } from 'passport-facebook'\r\nimport {UserModel as User} from '../models/UserModel'\r\nimport geoip from 'geoip-lite'\r\n\r\npassport.use('facebook-auth',new FacebookStrategy({\r\n    clientID: '3170951326462560',\r\n    clientSecret: 'e201c5704c07e7b3bcdc9f79a890feb2',\r\n    callbackURL: 'http://localhost:3000/auth/facebook/callback',\r\n    passReqToCallback: true,\r\n    profileFields: [\"id\", \"email\", \"first_name\", \"last_name\"]\r\n  },async (req, accessToken, refreshToken, profile, done) => {\r\n\r\n    User.find({email: profile.emails[0].value}, (err,docs) => {\r\n\r\n        console.log(docs)\r\n\r\n\t\tif(docs.length==0){\r\n\t\t\tconst newUser = new User()\r\n\r\n\t\t\tlet geo = geoip.lookup(req.ip)\r\n\t\t\t\r\n\t\t\tif(geo){\r\n\r\n\t\t\t\tlet userObject = newUser.encryptUser(\r\n\t\t\t\t\tprofile.emails[0].value,\r\n\t\t\t\t\tgeo.ll[0],\r\n\t\t\t\t\tgeo.ll[1],\r\n\t\t\t\t\tprofile.id\r\n\t\t\t\t)\r\n\t\t\t\r\n\t\t\t\tnewUser.name = profile.name.givenName\r\n\t\t\t\tnewUser.lastName = profile.name.familyName\r\n\t\t\t\tnewUser.email = userObject.email\r\n\t\t\t\tnewUser.lat = userObject.lat\r\n\t\t\t\tnewUser.lng = userObject.lng\r\n\t\t\t\tnewUser.password = userObject.password\r\n\t\t\t\tnewUser.type = 0\r\n\r\n\t\t\t\tconsole.log(newUser)\r\n\t\t\t\r\n\t\t\t\tnewUser.save()\r\n\t\t\t\tdone(null, newUser)\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\treturn done([\"BAD_LOCATION\"], false)\r\n\t\t\t}     \t\t\r\n\t\t}\r\n\t\telse{\r\n\t\t\tdone(null, docs[0])\r\n\t\t}\r\n\r\n\t})\r\n\r\n  }\r\n))"]}